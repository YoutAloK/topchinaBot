# Настройка бота для Render

## Переменные окружения для Render

В настройках вашего сервиса на Render добавьте следующие переменные окружения:

### Обязательные переменные:

- `BOT_TOKEN` - токен вашего Telegram бота
- `ADMIN_ID` - ваш Telegram ID
- `DB_HOST` - хост базы данных
- `DB_USER` - имя пользователя базы данных
- `DB_PASS` - пароль базы данных
- `DB_NAME` - название базы данных

### Дополнительные переменные:

- `DB_PORT` - порт базы данных (по умолчанию 3306)
- `NODE_ENV` - установите в `production`
- `RENDER_EXTERNAL_URL` - URL вашего приложения на Render (автоматически устанавливается Render)

## Настройка базы данных

### Для freedb.tech (рекомендуется):

1. Зарегистрируйтесь на https://freedb.tech
2. Создайте новую базу данных
3. Скопируйте данные подключения:
   - Host: sql.freedb.tech
   - Port: 3306
   - Username: freedb*ваш*логин
   - Password: ваш_пароль
   - Database: freedb*название*базы
4. Выполните SQL скрипт из файла `database_setup.sql` для создания таблиц

### Для других провайдеров:

1. Создайте базу данных MySQL
2. Убедитесь, что база данных доступна извне
3. Выполните SQL скрипт из файла `database_setup.sql`

## Особенности для Render

- **Webhook режим**: Бот автоматически использует webhook вместо polling в production
- **SSL соединения**: Настроены для работы с внешними базами данных
- **Повторные попытки**: Логика повторных попыток подключения к БД
- **Обработка ошибок**: Улучшенная диагностика проблем подключения
- **Graceful shutdown**: Корректное завершение работы с удалением webhook
- **Health check**: Endpoint `/health` для мониторинга состояния

## Проверка работы

После деплоя проверьте логи в панели Render - должно появиться сообщение:
"✅ Подключение к базе данных успешно"

Если возникают ошибки подключения, проверьте:

1. Правильность переменных окружения
2. Доступность базы данных извне
3. Настройки SSL для базы данных
